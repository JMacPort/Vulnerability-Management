This is the first lab using a vulernability management tool, this time know as Nessus. Nessus can run scans whether it be all ports, credentialed/uncredentialed, or scanning the entire cloud infrastructure. For this lab it will mostly be based on using common port scans, both credentialed and uncredentialed.
Once again, I will be using a [video](https://www.youtube.com/watch?v=lT6Px9zJM3s) by Josh Madakor, and then further remediating more vulnerabilities that weren't covered, just to get a cleaner final scan. I have not used vulnerability management software before, but I think the process will be mostly straightforward, 
and I will have a good grasp coming out of this lab.

The materials for this lab are [Nessus Essentials](https://www.tenable.com/products/nessus/nessus-essentials) and [VMWare Workstation Player](https://customerconnect.vmware.com/en/downloads/details?downloadGroup=WKST-PLAYER-1702&productId=1377&rPId=104734), along with the ISO for [Windows 10](https://www.microsoft.com/en-us/software-download/windows10). 

Download the above items and once all are downloaded we will start with Nessus. For the most part this will be a pretty default setup with Nessus and when the setup wizard has ended a new tab will open in the default browser. This tab is not hosted on the internet, but rather the local PC and will be used to communicate to the 
VM to run the vulnerability scans. Press Connect Via SSL to continue with the setup, make sure it is on Nessus Essentials, then enter your activation code that was emailed when the sign up originally took place. Then, create a username and password. 

![image](https://github.com/JMacPort/Vulnerability-Management/assets/145376972/7b0b3890-fafe-4407-be75-63de5aa3d857)

Now it should begin creating configurations and compiling plugins, which tends to take a few minutes. Once this is completed Nessus will open up to the main page with a sidebar for scans, plugins and more. For now we can leave the Nessus tab open and move over to VMWare to configure the Windows 10 VM.

In VMWare, go to Player, File and click New Virtual Machine. Click browse and find the Windows 10 ISO created earlier. Name it something relative, and leave the maximum disk size to default, >30GB is usually needed at least. Then select Customize Hardware. From here, the RAM should be increased if possible, along with the cores, 
but both can be left at the default settings for a less optimal experience. In Network Adapter, change to bridged and go to Configure Adapters and uncheck any adapters that are not going to be in use as this can cause issues when attempting to connect to the internet. Bridged essentially puts the VM on the host PCs internet 
connection so Nessus will be able to communicate locally. Once that is completed, follow through with the Windows setup as normal and choose Windows 10 Pro as the distribution. 

When the Windows 10 machine is fully booted and you are on the desktop, type ```ipconfig``` and this will display the network properties. The IPv4 address should be added to Nessus by selecting New Scan, Basic Network Scan. Then add the IP address in the Targets section.

![image](https://github.com/JMacPort/Vulnerability-Management/assets/145376972/3fa0ddc0-3d67-4ae3-8752-8e7fc2eec23b)

We are not done on the Windows machine just yet as we will go ahead and disable the firewall completely by typing ```wf.msc``` into the search bar and clicking Windows Defender Firewall Policies and disabling all of the profile tabs. Ensure you can connect to the VM by opening a command prompt and type ```ping (your VMs IPv4 address)```.
There should be a reply which means Nessus can do its first scans. 

Head back to the Nessus tab and you should still be on the Basic Network Scan with the IP of the VM input. Create a name for the scan and then go to the Discovery tab on the left and use the common ports option for scan type. From here, press save and you should now be in the My Scans section. Press launch and let the scan run until finished.

![image](https://github.com/JMacPort/Vulnerability-Management/assets/145376972/3442e8d3-9061-4c6e-9de2-996355f5fd73)
***Mine says "Cancelled" as a status because I accidentally stopped it, but got the necessary information anyways.***

Once finished, head over to the scan and check out the Vulnerabilities section to see the vulnerabilites that were discovered using this uncredentialed scan. There should be many info and maybe some medium/low as well but nothing critical, yet. Back in the My Scans section, check the scan that was created and press more, and then configure. Go over
to the Credentials tab, click Windows and enter in the credentials used to sign into the Windows 10 VM, leaving the rest of the options default.

![image](https://github.com/JMacPort/Vulnerability-Management/assets/145376972/478f2118-5f04-48c0-8382-83541fb18414)

Before we do a credentialed scan, on the Windows 10 machine, the service for this to be done needs to be enabled. Search for Services and then find the RemoteRegistry service, change the startup type to Automatic, Apply and then Start the service. Then, go to the Advanced Sharing Settings and make sure File and Printer sharing is enabled. 
This allows Nessus to browse the PC to check for any vulnerabilities within files as well. Again, in the search bar, type User Account Control Settings and change the notifications to Never Notify. And finally, go to the Registry Editor and use the following path: ```HKEY_LOCAL_MACHINE``` > ```SOFTWARE``` > ```MICROSOFT``` > ```WINDOWS``` > ```CurrentVersion``` > 
```Policies``` > ```System```.

Once in the System folder, right click and add a new DWORD. Name this ```LocalAccountTokenFilterPolicy```, double click and set the value to 1. This registry change should now allow Nessus to run a remote scan using the given credentials. Now restart the VM and get ready to scan within Nessus.

Again, we can now save and launch the scan. Let it finish its scan and the results should be plentiful with criticals, highs, etc. 

![image](https://github.com/JMacPort/Vulnerability-Management/assets/145376972/7ae5a341-e0b5-4215-90e5-9e5bb5ff1c6a)

The results above are from my scan which included more vulnerabilities than in Josh's example as the video was over a year old so, many more vulnerabilities have been found and CVE's have been published since. Look through the different vulnerabilities posted, click through them and check the various CVEs assocaited with each.
A Common Vulnerability and Exposure (CVE) is essentially the documentation behind a certain known vulnerability and tends to have the necessary steps to fix the issues. The remediations tab will show Nessus's recommendations on how to fix the certain vulnerabilities. Then, an [old version](https://ftp.mozilla.org/pub/firefox/releases/3.6.12/win32/en-US/) 
of Firefox was downloaded and rescanned the VM immediately after, which added many new critical vulnerabilities shown in the below scan. 

![image](https://github.com/JMacPort/Vulnerability-Management/assets/145376972/9d429136-9994-45c6-b382-3e65804992a1)

After this scan, the remdediation efforts can begin. This starts off by uninstalling Firefox to clear up a bunch of critical errors as it was just for demonstration purposes. Then open Windows Updates and check for updates, restarting the VM when necessary until it is fully updated to the current version and looks like below.

![image](https://github.com/JMacPort/Vulnerability-Management/assets/145376972/b193368b-70c9-48c5-895e-a9272fa24f81)

From here we can work on assessing the various vulnerabilities shown in Nessus, while I won't go over every singly one individually. I started off by assessing the critical vulnerabilties, many of which were fixed by launching the Microsoft Store and updating the various apps. One example of this was MS Paint having an exploit where an attacker could 
execute arbitrary code via a custom program that makes a specific file. While not the most dangerous, there is no reason to not fix this. So I checked the provided CVE [links](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2023-32047) which discusses the vulnerability in a bit more detail and shows how to check to make sure the app is properly updated.
A Powershell window was opened and used the ```Get-AppxPackage -Name Microsoft.MSPaint``` command to check the version and was able to verify it was patched properly. I did this with any all of the included apps I was able to, but had difficulty patching the new cURL version along with the VMware Tools updated version.

Other than the two previously mentioned, I was able to clear out all of the other critical and high vulnerabilities, mostly by downloading the new versions. This is shown below and is the final scan I executed with Nessus on the Windows 10 VM as I was satisfied with the results knowing I did everything I was able to. 

![image](https://github.com/JMacPort/Vulnerability-Management/assets/145376972/4e00d77f-8097-4f26-acad-9573a2e3c4eb)

Overall this lab was extrememly informative and reinforced proper VM setup and cleanup. Along with, understanding the basic scan capabilities of Nessus which I will continue to play around with more. I personally want to test some of the other scan types and possibly do full port scans to check. One I am interested in is the Active Directory scan to check for 
misconfigurations as I have that setup in another VM environment as well. I can pretty confidently say, at least in a controlled home environment, that I understand how to use Nessus to scan VMs and then further remediate these issues. 










